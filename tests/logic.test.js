import { calculateGTS } from '../assets/js/logic';

describe('calculateGTS', () => {
    test('calculates cumulative GTS values correctly', () => {
        const dates = ['2025-01-01', '2025-01-02', '2025-01-03'];
        const values = [10, 15, 20];
        const result = calculateGTS(dates, values);
        expect(result).toEqual([
            // 0 + (10 * 0.5) = 5
            { date: '2025-01-01', gts: 5 },
            // 5 + (15 * 0.5) = 12.5
            { date: '2025-01-02', gts: 12.5 },
            // 12.5 + (20 * 0.5) = 22.5
            { date: '2025-01-03', gts: 22.5 },
        ]);
    });

    test('keeps GTS stable across consecutive non-positive days', () => {
        const dates = ['2025-12-30', '2025-12-31'];
        const values = [5, -2];
        const result = calculateGTS(dates, values);
        expect(result[0].gts).toBe(result[1].gts);
    });
});

describe('calculateGTS with larger dataset', () => {
    test('calculates cumulative GTS values correctly for a larger dataset with mixed values', () => {
        const dates = [
            "2025-01-01",
            "2025-01-02",
            "2025-01-03",
            "2025-01-04",
            "2025-01-05",
            "2025-01-06"
        ];
        const values = [
            0.4,
            5.2,
            0,
            -2.8,
            4.4,
            5.3
        ];
        const result = calculateGTS(dates, values);
        expect(result).toEqual([
            // 0 + (0.2 * 0.5) = 0.2
            { date: '2025-01-01', gts: 0.2 },
            // 0.2 + (5.2 * 0.5) = 2.8
            { date: '2025-01-02', gts: 2.8 },
            // 2.8 + (0 * 0.5) = 2.8
            { date: '2025-01-03', gts: 2.8 },
            // 2.8 + (0 * 0.5) = 2.8
            { date: '2025-01-04', gts: 2.8 },
            // 2.8 + (4.4 * 0.5) = 5.0
            { date: '2025-01-05', gts: 5.0 },
            // 5.0 + (5.3 * 0.5) = 7.65
            { date: '2025-01-06', gts: 7.65 },
        ]);
    });
});

describe('calculateGTS with even larger dataset spanning Jan-March', () => {
    test('calculates cumulative GTS values correctly for a larger dataset spanning over Jan-March', () => {
        
    const epsilon = 0.01; // due to rounding errors

        const dates = [
            "2024-01-01",
            "2024-01-02",
            "2024-01-03",
            "2024-01-04",
            "2024-01-05",
            "2024-01-06",
            "2024-01-07",
            "2024-01-08",
            "2024-01-09",
            "2024-01-10",
            "2024-01-11",
            "2024-01-12",
            "2024-01-13",
            "2024-01-14",
            "2024-01-15",
            "2024-01-16",
            "2024-01-17",
            "2024-01-18",
            "2024-01-19",
            "2024-01-20",
            "2024-01-21",
            "2024-01-22",
            "2024-01-23",
            "2024-01-24",
            "2024-01-25",
            "2024-01-26",
            "2024-01-27",
            "2024-01-28",
            "2024-01-29",
            "2024-01-30",
            "2024-01-31",
            "2024-02-01",
            "2024-02-02",
            "2024-02-03",
            "2024-02-04",
            "2024-02-05",
            "2024-02-06",
            "2024-02-07",
            "2024-02-08",
            "2024-02-09",
            "2024-02-10",
            "2024-02-11",
            "2024-02-12",
            "2024-02-13",
            "2024-02-14",
            "2024-02-15",
            "2024-02-16",
            "2024-02-17",
            "2024-02-18",
            "2024-02-19",
            "2024-02-20",
            "2024-02-21",
            "2024-02-22",
            "2024-02-23",
            "2024-02-24",
            "2024-02-25",
            "2024-02-26",
            "2024-02-27",
            "2024-02-28",
            "2024-02-29",
            "2024-03-01",
            "2024-03-02",
            "2024-03-03"
        ];
        const values = [
            5.1,
            7.3,
            8.8,
            6.4,
            5.4,
            3.7,
            1,
            -3.2,
            -4.3,
            -4.1,
            -4.4,
            -4.5,
            -4,
            -4.5,
            -1.6,
            -2.8,
            1.9,
            2.1,
            -3,
            -4.5,
            -1.1,
            6.1,
            5.5,
            9.5,
            7.1,
            7.6,
            0.5,
            -0.3,
            2.1,
            3.8,
            4,
            6.7,
            4.9,
            6.5,
            7.9,
            7,
            4.8,
            7.8,
            9.6,
            10.2,
            7.6,
            6.9,
            6.3,
            4.5,
            7.4,
            9,
            9.9,
            9.2,
            6.5,
            8.3,
            6.3,
            7.4,
            9.3,
            5.2,
            3.7,
            4.3,
            7.1,
            6.5,
            5.4,
            3.7,
            4.8,
            7.5,
            7.8
        ];

        const result = calculateGTS(dates, values);

        const expected = [
            // 0 + (2.5 * 0.5) = 2.55
            { date: '2024-01-01', gts: 2.55 },
            // 2.55 + (7.3 * 0.5) = 6.2
            { date: '2024-01-02', gts: 6.2 },
            // 6.2 + (8.8 * 0.5) = 10.6
            { date: '2024-01-03', gts: 10.6 },
            // 10.6 + (6.4 * 0.5) = 13.8
            { date: '2024-01-04', gts: 13.8 },
            // 13.8 + (5.4 * 0.5) = 16.5
            { date: '2024-01-05', gts: 16.5 },
            // 16.5 + (3.7 * 0.5) = 18.35
            { date: '2024-01-06', gts: 18.35 },
            // 18.35 + (1.0 * 0.5) = 18.85
            { date: '2024-01-07', gts: 18.85 },
            // 18.85 + (0 * 0.5) = 18.85
            { date: '2024-01-08', gts: 18.85 },
            // 18.85 + (0 * 0.5) = 18.85
            { date: '2024-01-09', gts: 18.85 },
            // 18.85 + (0 * 0.5) = 18.85
            { date: '2024-01-10', gts: 18.85 },
            // 18.85 + (0 * 0.5) = 18.85
            { date: '2024-01-11', gts: 18.85 },
            // 18.85 + (0 * 0.5) = 18.85
            { date: '2024-01-12', gts: 18.85 },
            // 18.85 + (0 * 0.5) = 18.85
            { date: '2024-01-13', gts: 18.85 },
            // 18.85 + (0 * 0.5) = 18.85
            { date: '2024-01-14', gts: 18.85 },
            // 18.85 + (0 * 0.5) = 18.85
            { date: '2024-01-15', gts: 18.85 },
            // 18.85 + (0 * 0.5) = 18.85
            { date: '2024-01-16', gts: 18.85 },
            // 18.85 + (1.9 * 0.5) = 19.8
            { date: '2024-01-17', gts: 19.8 },
            // 19.8 + (2.1 * 0.5) = 20.85
            { date: '2024-01-18', gts: 20.85 },
            // 20.85 + (0 * 0.5) = 20.85
            { date: '2024-01-19', gts: 20.85 },
            // 20.85 + (0 * 0.5) = 20.85
            { date: '2024-01-20', gts: 20.85 },
            // 20.85 + (0 * 0.5) = 20.85
            { date: '2024-01-21', gts: 20.85 },
            // 20.85 + (6.1 * 0.5) = 23.9
            { date: '2024-01-22', gts: 23.9 },
            // 23.9 + (5.5 * 0.5) = 26.65
            { date: '2024-01-23', gts: 26.65 },
            // 26.65 + (9.5 * 0.5) = 31.4
            { date: '2024-01-24', gts: 31.4 },
            // 31.4 + (7.1 * 0.5) = 34.95
            { date: '2024-01-25', gts: 34.95 },
            // 34.95 + (7.6 * 0.5) = 38.75
            { date: '2024-01-26', gts: 38.75 },
            // 38.75 + (0.5 * 0.5) = 39.0
            { date: '2024-01-27', gts: 39.0 },
            // 39.0 + (0 * 0.5) = 39.0
            { date: '2024-01-28', gts: 39.0 },
            // 39.0 + (2.1 * 0.5) = 40.05
            { date: '2024-01-29', gts: 40.05 },
            // 40.05 + (3.8 * 0.5) = 41.95
            { date: '2024-01-30', gts: 41.95 },
            // 41.95 + (4.0 * 0.5) = 43.95
            { date: '2024-01-31', gts: 43.95 },
            // 43.95 + (6.7 * 0.75) = 48.97
            { date: '2024-02-01', gts: 48.97 },
            // 48.97 + (4.9 * 0.75) = 52.65
            { date: '2024-02-02', gts: 52.65 },
            // 52.65 + (6.5 * 0.75) = 57.52
            { date: '2024-02-03', gts: 57.52 },
            // 57.52 + (7.9 * 0.75) = 63.45
            { date: '2024-02-04', gts: 63.45 },
            // 63.45 + (7.0 * 0.75) = 68.7
            { date: '2024-02-05', gts: 68.7 },
            // 68.7 + (4.8 * 0.75) = 72.3
            { date: '2024-02-06', gts: 72.3 },
            // 72.3 + (7.8 * 0.75) = 78.15
            { date: '2024-02-07', gts: 78.15 },
            // 78.15 + (9.6 * 0.75) = 85.35
            { date: '2024-02-08', gts: 85.35 },
            // 85.35 + (10.2 * 0.75) = 93.0
            { date: '2024-02-09', gts: 93.0 },
            // 93.0 + (7.6 * 0.75) = 98.7
            { date: '2024-02-10', gts: 98.7 },
            // 98.7 + (6.9 * 0.75) = 103.87
            { date: '2024-02-11', gts: 103.87 },
            // 103.87 + (6.3 * 0.75) = 108.6
            { date: '2024-02-12', gts: 108.6 },
            // 108.6 + (4.5 * 0.75) = 111.97
            { date: '2024-02-13', gts: 111.97 },
            // 111.97 + (7.4 * 0.75) = 117.52
            { date: '2024-02-14', gts: 117.52 },
            // 117.52 + (9.0 * 0.75) = 124.27
            { date: '2024-02-15', gts: 124.27 },
            // 124.27 + (9.9 * 0.75) = 131.7
            { date: '2024-02-16', gts: 131.7 },
            // 131.7 + (9.2 * 0.75) = 138.6
            { date: '2024-02-17', gts: 138.6 },
            // 138.6 + (6.5 * 0.75) = 143.47
            { date: '2024-02-18', gts: 143.47 },
            // 143.47 + (8.3 * 0.75) = 149.7
            { date: '2024-02-19', gts: 149.7 },
            // 149.7 + (6.3 * 0.75) = 154.42
            { date: '2024-02-20', gts: 154.42 },
            // 154.42 + (7.4 * 0.75) = 159.97
            { date: '2024-02-21', gts: 159.97 },
            // 159.97 + (9.3 * 0.75) = 166.95
            { date: '2024-02-22', gts: 166.95 },
            // 166.95 + (5.2 * 0.75) = 170.85
            { date: '2024-02-23', gts: 170.85 },
            // 170.85 + (3.7 * 0.75) = 173.62
            { date: '2024-02-24', gts: 173.62 },
            // 173.62 + (4.3 * 0.75) = 176.85
            { date: '2024-02-25', gts: 176.85 },
            // 176.85 + (7.1 * 0.75) = 182.17
            { date: '2024-02-26', gts: 182.17 },
            // 182.17 + (6.5 * 0.75) = 187.05
            { date: '2024-02-27', gts: 187.05 },
            // 187.05 + (5.4 * 0.75) = 191.1
            { date: '2024-02-28', gts: 191.1 },
            // 191.1 + (3.7 * 0.75) = 193.88
            { date: '2024-02-29', gts: 193.88 },
            // 193.88 + (4.8 * 1.0) = 198.68
            { date: '2024-03-01', gts: 198.68 },
            // 198.68 + (7.5 * 1.0) = 206.18
            { date: '2024-03-02', gts: 206.18 },
            // 206.18 + (7.8 * 1.0) = 213.98
            { date: '2024-03-03', gts: 213.98 },
        ];

        expected.forEach((exp, index) => {
            expect(result[index].date).toBe(exp.date);
            expect(result[index].gts).toBeCloseTo(exp.gts, epsilon);
        });

    });
});
